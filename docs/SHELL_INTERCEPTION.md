# –ú–ï–•–ê–ù–ò–ó–ú –ü–ï–†–ï–•–í–ê–¢–ê SHELL –ö–û–ú–ê–ù–î

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã](#–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)
3. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
4. [–ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã](#–ø—Ä–æ—Ü–µ—Å—Å-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è-–∫–æ–º–∞–Ω–¥—ã)
5. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–ø–æ—Ç–æ–∫–æ–≤-–≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞)
6. [Root –¥–æ—Å—Ç—É–ø –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏](#root-–¥–æ—Å—Ç—É–ø-–∏-–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
9. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–∏-–æ—Ç–ª–∞–¥–∫–∞)

---

## üéØ –í–≤–µ–¥–µ–Ω–∏–µ

**ShellCommandInterceptor** ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ shell –∫–æ–º–∞–Ω–¥ –Ω–∞ Android —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö. –ö–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Java ProcessBuilder API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∏—Ö –ø–æ—Ç–æ–∫–æ–≤ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ª—é–±—ã—Ö shell –∫–æ–º–∞–Ω–¥
- ‚úÖ –ü–µ—Ä–µ—Ö–≤–∞—Ç –≤—ã–≤–æ–¥–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ root –∫–æ–º–∞–Ω–¥
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ pipe –æ–ø–µ—Ä–∞—Ü–∏–π (`|`, `&&`, `||`)
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (timeouts)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

---

## ‚öôÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  ShellCommandInterceptor                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Command   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ ProcessBuilder‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   New Process   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Parser    ‚îÇ    ‚îÇ              ‚îÇ    ‚îÇ                 ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   STDOUT    ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ  Stream      ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ     Shell       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Reader    ‚îÇ    ‚îÇ  Interceptor ‚îÇ    ‚îÇ     Process     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   STDERR    ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ  Async       ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ     Output      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ   Reader    ‚îÇ    ‚îÇ  Reader      ‚îÇ    ‚îÇ     Streams     ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∫–æ–º–∞–Ω–¥—ã

```
–ö–æ–º–∞–Ω–¥–∞ ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ ‚Üí –ü–µ—Ä–µ—Ö–≤–∞—Ç –ø–æ—Ç–æ–∫–æ–≤ ‚Üí –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç
   ‚îÇ         ‚îÇ            ‚îÇ                ‚îÇ               ‚îÇ           ‚îÇ
   ‚ñº         ‚ñº            ‚ñº                ‚ñº               ‚ñº           ‚ñº
"ls -la" ‚Üí ["ls","-la"] ‚Üí ProcessBuilder ‚Üí STDIN/STDOUT ‚Üí Async Read ‚Üí JSON Result
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. ProcessBuilder - –æ—Å–Ω–æ–≤–∞ —Å–∏—Å—Ç–µ–º—ã

ProcessBuilder ‚Äî —ç—Ç–æ Java –∫–ª–∞—Å—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:

```java
// –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
ProcessBuilder pb = new ProcessBuilder("ls", "-la", "/system");
pb.directory(new File("/"));  // –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
pb.redirectErrorStream(false); // –†–∞–∑–¥–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ STDOUT/STDERR
Process process = pb.start(); // –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
```

### 2. –ü–æ—Ç–æ–∫–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

–ö–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –∏–º–µ–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞:

```java
// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–∞
InputStream stdout = process.getInputStream();   // –í—ã–≤–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã
InputStream stderr = process.getErrorStream();  // –û—à–∏–±–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã  
OutputStream stdin = process.getOutputStream(); // –í–≤–æ–¥ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
```

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤

```java
// –°–æ–∑–¥–∞–Ω–∏–µ —á–∏—Ç–∞—Ç–µ–ª–µ–π
BufferedReader stdoutReader = new BufferedReader(new InputStreamReader(stdout));
BufferedReader stderrReader = new BufferedReader(new InputStreamReader(stderr));

// –ó–∞–ø—É—Å–∫ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö
Thread stdoutThread = new Thread(() -> readStream(stdoutReader, outputBuilder, false));
Thread stderrThread = new Thread(() -> readStream(stderrReader, errorBuilder, true));

stdoutThread.start();
stderrThread.start();
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

### –®–∞–≥ 1: –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–∞–Ω–¥—ã

```java
private ProcessBuilder createProcessBuilder(String command) {
    List<String> commandArgs = new ArrayList<>();
    
    if (needsRootAccess(command) && isRootAvailable) {
        // Root –∫–æ–º–∞–Ω–¥–∞: su -c "command"
        commandArgs.add("su");
        commandArgs.add("-c");
        commandArgs.add(command);
    } else if (command.contains("|") || command.contains("&&")) {
        // Pipe –∫–æ–º–∞–Ω–¥–∞: /system/bin/sh -c "command"
        commandArgs.add("/system/bin/sh");
        commandArgs.add("-c");
        commandArgs.add(command);
    } else {
        // –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞: ["ls", "-la", "/system"]
        String[] parts = command.split("\\s+");
        commandArgs.addAll(Arrays.asList(parts));
    }
    
    return new ProcessBuilder(commandArgs);
}
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞

```java
ProcessBuilder processBuilder = createProcessBuilder(command);

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
processBuilder.environment().put("PATH", System.getenv("PATH"));
processBuilder.environment().put("ANDROID_ROOT", "/system");

// –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
Process process = processBuilder.start();
```

### –®–∞–≥ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

```java
// –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å timeout
boolean finished = process.waitFor(timeoutMs, TimeUnit.MILLISECONDS);

if (finished) {
    int exitCode = process.exitValue(); // –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
} else {
    process.destroyForcibly(); // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ timeout
}
```

---

## üì° –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–æ–≤ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞

### –ü–æ—á–µ–º—É –Ω—É–∂–Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —á—Ç–µ–Ω–∏–µ?

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ –Ω–µ —á–∏—Ç–∞—Ç—å –ø–æ—Ç–æ–∫–∏ –≤—ã–≤–æ–¥–∞, –æ–Ω–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è –∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–∏—Å–Ω–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ**: –ß–∏—Ç–∞–µ–º STDOUT –∏ STDERR –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞:

```java
private void readStream(BufferedReader reader, StringBuilder output, 
                       String command, boolean isErrorStream) {
    try {
        String line;
        int lineCount = 0;
        
        while ((line = reader.readLine()) != null) {
            lineCount++;
            
            // –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –ø–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥
            output.append(line).append("\n");
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É —á–µ—Ä–µ–∑ callback
            if (callback != null) {
                callback.onCommandOutput(command, line, isErrorStream);
            }
            
            // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
            if (output.length() > MAX_OUTPUT_LENGTH) {
                output.append("\n... [–û–ë–†–ï–ó–ê–ù–û]");
                break;
            }
        }
    } catch (IOException e) {
        output.append("\n[–û–®–ò–ë–ö–ê –ß–¢–ï–ù–ò–Ø]: ").append(e.getMessage());
    }
}
```

### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏:

```
–ö–æ–º–∞–Ω–¥–∞: "ps | grep com.example"

ProcessBuilder —Å–æ–∑–¥–∞–µ—Ç: ["/system/bin/sh", "-c", "ps | grep com.example"]

–ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è ‚Üí Shell –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—É

STDOUT –ø–æ—Ç–æ–∫:
‚îú‚îÄ "1234 u0_a123 com.example.app"
‚îú‚îÄ "5678 u0_a123 com.example.service"  
‚îî‚îÄ [EOF]

STDERR –ø–æ—Ç–æ–∫:
‚îî‚îÄ [–ü—É—Å—Ç–æ–π –∏–ª–∏ –æ—à–∏–±–∫–∏]

–†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "command": "ps | grep com.example",
  "exit_code": 0,
  "output": "1234 u0_a123 com.example.app\n5678 u0_a123 com.example.service\n",
  "error_output": "",
  "success": true
}
```

---

## üîë Root –¥–æ—Å—Ç—É–ø –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ root:

```java
private boolean checkRootAccess() {
    try {
        Process process = Runtime.getRuntime().exec("su -c 'id'");
        boolean finished = process.waitFor(3, TimeUnit.SECONDS);
        
        return finished && process.exitValue() == 0;
    } catch (Exception e) {
        return false;
    }
}
```

### –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ root –∫–æ–º–∞–Ω–¥:

```java
// –û–±—ã—á–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
["ls", "-la"]

// Root –∫–æ–º–∞–Ω–¥–∞  
["su", "-c", "ls -la /data/data"]
```

### –ö–æ–º–∞–Ω–¥—ã, —Ç—Ä–µ–±—É—é—â–∏–µ root:

- `su`, `mount`, `umount`
- `reboot`, `shutdown`
- `pm install`, `pm uninstall`
- –†–∞–±–æ—Ç–∞ —Å `/system/`, `/data/data/`
- `iptables`, —Å–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–ø–∞—Å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥:

```java
public boolean isCommandSafe(String command) {
    String[] dangerousCommands = {
        "rm -rf /",        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ—Ä–Ω–µ–≤–æ–π –§–°
        "format",          // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        "dd if=/dev/zero", // –ó–∞—Ç–∏—Ä–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        ":(){ :|:& };:"    // Fork bomb
    };
    
    for (String dangerous : dangerousCommands) {
        if (command.toLowerCase().contains(dangerous)) {
            Log.w(TAG, "–û–ü–ê–°–ù–ê–Ø –ö–û–ú–ê–ù–î–ê –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê: " + command);
            return false;
        }
    }
    return true;
}
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- **Timeout**: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
- **Memory limit**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –≤—ã–≤–æ–¥–∞
- **Access control**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

### 3. –ê—É–¥–∏—Ç –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```java
Log.d(TAG, "=== –ù–ê–ß–ê–õ–û –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ö–û–ú–ê–ù–î–´ ===");
Log.d(TAG, "–ö–æ–º–∞–Ω–¥–∞: " + command);
Log.d(TAG, "Root –¥–æ—Å—Ç—É–ø: " + (needsRoot ? "–î–ê" : "–ù–ï–¢"));
Log.d(TAG, "–ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: " + exitCode);
Log.d(TAG, "=== –ö–û–ù–ï–¶ –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ö–û–ú–ê–ù–î–´ ===");
```

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞:

```java
ShellCommandInterceptor interceptor = new ShellCommandInterceptor();
interceptor.setCallback(new CommandExecutionCallback() {
    @Override
    public void onCommandCompleted(String command, int exitCode, 
                                  String output, String errorOutput) {
        Log.i(TAG, "–ö–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: " + command);
        Log.i(TAG, "–†–µ–∑—É–ª—å—Ç–∞—Ç: " + output);
    }
});

interceptor.executeCommand("ls -la /system/bin");
```

### 2. Root –∫–æ–º–∞–Ω–¥–∞:

```java
interceptor.executeCommand("su -c 'cat /data/system/packages.xml'");
```

### 3. Pipe –∫–æ–º–∞–Ω–¥–∞:

```java
interceptor.executeCommand("ps | grep com.android | wc -l");
```

### 4. –ö–æ–º–∞–Ω–¥–∞ —Å timeout:

```java
interceptor.executeCommand("ping -c 10 google.com", 15000); // 15 —Å–µ–∫—É–Ω–¥
```

### 5. –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:

```java
interceptor.getProcessList();        // ps -A
interceptor.getSystemInfo();         // cat /proc/version
interceptor.getNetworkInfo();        // ip addr show  
interceptor.pingHost("8.8.8.8");     // ping -c 4 8.8.8.8
```

---

## üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

```
D/ShellCommandInterceptor: === –ù–ê–ß–ê–õ–û –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ö–û–ú–ê–ù–î–´ ===
D/ShellCommandInterceptor: –ö–æ–º–∞–Ω–¥–∞: ls -la /system
D/ShellCommandInterceptor: –¢–∞–π–º-–∞—É—Ç: 30000 –º—Å
D/ShellCommandInterceptor: ProcessBuilder —Å–æ–∑–¥–∞–Ω:
D/ShellCommandInterceptor: - –ö–æ–º–∞–Ω–¥–∞: [ls, -la, /system]
D/ShellCommandInterceptor: - –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: null
D/ShellCommandInterceptor: –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω —Å PID: 12345678
D/ShellCommandInterceptor: –ü–æ—Ç–æ–∫–∏ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
D/ShellCommandInterceptor: –ü–æ—Ç–æ–∫–∏ —á—Ç–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω—ã
D/ShellCommandInterceptor: –ù–∞—á–∞–ª–æ —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ STDOUT
D/ShellCommandInterceptor: –ù–∞—á–∞–ª–æ —á—Ç–µ–Ω–∏—è –ø–æ—Ç–æ–∫–∞ STDERR
D/ShellCommandInterceptor: –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –∫–æ–¥–æ–º: 0
D/ShellCommandInterceptor: STDOUT –∑–∞–≤–µ—Ä—à–µ–Ω. –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: 25
D/ShellCommandInterceptor: STDERR –∑–∞–≤–µ—Ä—à–µ–Ω. –í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: 0
D/ShellCommandInterceptor: === –†–ï–ó–£–õ–¨–¢–ê–¢ –í–´–ü–û–õ–ù–ï–ù–ò–Ø ===
D/ShellCommandInterceptor: –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 0
D/ShellCommandInterceptor: –†–∞–∑–º–µ—Ä –≤—ã–≤–æ–¥–∞: 1543 —Å–∏–º–≤–æ–ª–æ–≤
D/ShellCommandInterceptor: –†–∞–∑–º–µ—Ä –æ—à–∏–±–æ–∫: 0 —Å–∏–º–≤–æ–ª–æ–≤
D/ShellCommandInterceptor: –†–µ—Å—É—Ä—Å—ã –æ—á–∏—â–µ–Ω—ã
D/ShellCommandInterceptor: === –ö–û–ù–ï–¶ –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ö–û–ú–ê–ù–î–´ ===
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:

#### 1. –ö–æ–º–∞–Ω–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

```
–û—à–∏–±–∫–∞: /system/bin/sh: invalid_command: not found
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã
```

#### 2. –ù–µ—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

```
–û—à–∏–±–∫–∞: Permission denied
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å root –ø—Ä–∞–≤–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∞ —Ñ–∞–π–ª–∞
```

#### 3. Timeout –∫–æ–º–∞–Ω–¥—ã

```
–û—à–∏–±–∫–∞: Command timeout after 30000ms
–†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å timeout –∏–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É
```

#### 4. –ü–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∞

```
–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –í—ã–≤–æ–¥ –æ–±—Ä–µ–∑–∞–Ω –¥–æ 1048576 —Å–∏–º–≤–æ–ª–æ–≤
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é (head, tail, grep)
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```java
JSONObject stats = interceptor.getStats();
// –†–µ–∑—É–ª—å—Ç–∞—Ç:
{
  "root_available": true,
  "max_output_length": 1048576,
  "default_timeout_ms": 30000,
  "default_shell": "/system/bin/sh"
}
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥:

```bash
# –ü–ª–æ—Ö–æ - –º–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
cat /proc/meminfo

# –•–æ—Ä–æ—à–æ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥  
cat /proc/meminfo | head -10

# –ü–ª–æ—Ö–æ - –¥–æ–ª–≥–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
find / -name "*.apk" 

# –•–æ—Ä–æ—à–æ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
find /system -maxdepth 2 -name "*.apk"
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```java
private static final int DEFAULT_TIMEOUT_MS = 30000;      // 30 —Å–µ–∫—É–Ω–¥
private static final int MAX_OUTPUT_LENGTH = 1024 * 1024; // 1MB
private static final String DEFAULT_SHELL = "/system/bin/sh";
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```java
pb.environment().put("PATH", System.getenv("PATH"));
pb.environment().put("ANDROID_ROOT", "/system");
pb.environment().put("ANDROID_DATA", "/data");
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ö–∞–∂–¥–∞—è –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å
- –ü—Ä–æ—Ü–µ—Å—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–∑—ã–≤–∞—Ç—å `shutdown()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ù–µ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –æ—Ç –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞—É–¥–∏—Ç–∞

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ò–∑–±–µ–≥–∞–π—Ç–µ —á–∞—Å—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–∞–Ω–¥
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –≤—ã–≤–æ–¥–∞
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ä–∞–∑—É–º–Ω—ã–µ timeout'—ã

---

**–ê–≤—Ç–æ—Ä**: ReliableSecurity  
**Telegram**: @ReliableSecurity  
**GitHub**: https://github.com/ReliableSecurity/android-remote-monitoring

**–ü–æ–º–Ω–∏—Ç–µ**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –∏ —Å —Å–æ–≥–ª–∞—Å–∏—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞!